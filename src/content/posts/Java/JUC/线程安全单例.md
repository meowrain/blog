---
title: çº¿ç¨‹å®‰å…¨å•ä¾‹
published: 2025-08-07
description: ''
image: ''
tags: [JUC,JAVA,volatile,çº¿ç¨‹å®‰å…¨,å•ä¾‹æ¨¡å¼]
category: 'Java > JUC'
draft: false 
lang: ''
---


![](https://blog.meowrain.cn/api/i/2025/05/27/11a6ta3-0.webp)
# 1 è§£å†³ååºåˆ—åŒ–å¯¼è‡´çš„å•ä¾‹ç ´åç°è±¡

è¿™é‡Œçš„å•ä¾‹é—®é¢˜æ˜¯ï¼Œå¦‚æœå¯¹ä¸€ä¸ªå¯åºåˆ—åŒ–å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™å°±è¿èƒŒäº†æˆ‘ä»¬æƒ³è¦å…¨å±€å•ä¾‹çš„ç›®æ ‡ã€‚å› æ­¤è¦é‡å†™readResolveæ–¹æ³•ã€‚

![](https://blog.meowrain.cn/api/i/2025/05/26/sjvikb-0.webp)

```java
package org.example.sigletons;

import java.io.Serializable;

public class Singleton1 implements Serializable {
    private Singleton1(){}
    private static final Singleton1 INSTANCE = new Singleton1();
    public Singleton1 getInstance() {
        return INSTANCE;
    }
    public Object readResolve() {
        return INSTANCE;
    }
}

```

# 2 ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼
![](https://blog.meowrain.cn/api/i/2025/05/26/swwpe2-0.webp)

```java
package org.example.sigletons;

import java.io.IOException;
import java.io.InputStream;
import java.util.Properties;

public enum Singleton2 {
    INSTANCE;
    private final Properties properties;
    private Singleton2() {
        properties = new Properties();
        String configFile = "application.properties";
        System.out.println("ConfigurationManager: Initializing and loading " + configFile);
        try(InputStream inputStream = Singleton2.class.getClassLoader().getResourceAsStream(configFile)){
            if(inputStream == null){
                System.out.println("ConfigurationManager: Sorry, unable to find " + configFile);
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œå¯èƒ½æŠ›å‡ºå¼‚å¸¸æˆ–æœ‰æ›´å¤æ‚çš„é”™è¯¯å¤„ç†
                return;
            }
            properties.load(inputStream);
            System.out.println("ConfigurationManager: Configuration loaded successfully.");
        }catch (IOException e) {
            e.printStackTrace();
        }
    }
    public String getProperty(String key) {
        return properties.getProperty(key);
    }
    public String getProperty(String key,String defaultValue) {
        return properties.getProperty(key, defaultValue);
    }

    // å¯ä»¥æ·»åŠ å…¶ä»–éœ€è¦çš„æ–¹æ³•ï¼Œæ¯”å¦‚é‡æ–°åŠ è½½é…ç½®ç­‰ï¼ˆéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼‰
    public void listProperties() {
        properties.forEach((key, value) -> System.out.println(key + "=" + value));
    }
}
class TestSingleton2 {
    public static void main(String[] args) {
        Singleton2 singleton2 = Singleton2.INSTANCE;
        singleton2.listProperties();
    }
}
```

![](https://blog.meowrain.cn/api/i/2025/05/26/swav0i-0.webp)


ğŸ’ æšä¸¾å•ä¾‹ï¼šå…¨é¢è§£ç­”è¿™äº›é—®é¢˜ï¼ğŸ“œâœ¨

æšä¸¾å•ä¾‹æ˜¯ä¸€ç§éå¸¸æ¨èçš„å•ä¾‹å®ç°æ–¹å¼ï¼Œå› ä¸ºå®ƒä¸ä»…ç®€å•ã€æ˜“ç”¨ï¼Œè¿˜å¤©ç„¶åœ°å…·å¤‡çº¿ç¨‹å®‰å…¨å’Œé˜²æ­¢ååºåˆ—åŒ–ã€åå°„ç ´åå•ä¾‹çš„èƒ½åŠ›ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡ç‚¹é’ˆå¯¹ **æšä¸¾å•ä¾‹** æ¥å›ç­”è¿™äº›é—®é¢˜ï¼

---

### **é—®é¢˜ 1ï¼šæšä¸¾å•ä¾‹æ˜¯å¦‚ä½•é™åˆ¶å®ä¾‹ä¸ªæ•°çš„ï¼Ÿ**

æšä¸¾å•ä¾‹é€šè¿‡æšä¸¾çš„æœºåˆ¶å¤©ç„¶åœ°ä¿è¯ï¼š
1. æšä¸¾ç±»çš„æ¯ä¸€ä¸ªæšä¸¾å®ä¾‹ï¼ˆå¦‚å•ä¾‹å¯¹è±¡ï¼‰éƒ½åœ¨ **ç±»åŠ è½½é˜¶æ®µ** å°±å®Œæˆåˆå§‹åŒ–ï¼Œå¹¶ä¸”æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚
2. æšä¸¾ç±»å‹åº•å±‚ç”± JVM çš„å®ç°æœºåˆ¶ä¿è¯ï¼Œå®ƒä¸åƒæ™®é€šç±»é‚£æ ·å…è®¸é€šè¿‡åå°„æˆ– `new` é¢å¤–åˆ›å»ºå®ä¾‹ã€‚

#### ç¤ºä¾‹ï¼š
```java
public enum SingletonEnum {
    INSTANCE; // æšä¸¾å•ä¾‹å®ä¾‹

    public void doSomething() {
        System.out.println("Doing something...");
    }
}
```

#### ä½¿ç”¨æ–¹å¼ï¼š
å³ä¾¿é€šè¿‡ `SingletonEnum.INSTANCE` å¤šæ¬¡è·å–ï¼Œå¾—åˆ°çš„å§‹ç»ˆæ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚
```java
SingletonEnum instance1 = SingletonEnum.INSTANCE;
SingletonEnum instance2 = SingletonEnum.INSTANCE;
System.out.println(instance1 == instance2); // è¾“å‡ºï¼štrue
``` 

---

### **é—®é¢˜ 2ï¼šæšä¸¾å•ä¾‹åœ¨åˆ›å»ºæ—¶æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜ï¼Ÿ**

æšä¸¾å•ä¾‹å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºï¼š
1. æšä¸¾ç±»å‹çš„åˆå§‹åŒ–ç”± JVM ä¿è¯ï¼Œæ˜¯åœ¨ç±»åŠ è½½æ—¶å®Œæˆçš„ã€‚
2. ç±»åŠ è½½è¿‡ç¨‹æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒJVM ä½¿ç”¨äº†ç±»åŠ è½½çš„åŒæ­¥æœºåˆ¶ï¼Œä¿è¯æšä¸¾å•ä¾‹çš„åˆå§‹åŒ–ä¸ä¼šå› å¤šçº¿ç¨‹è€Œå‘ç”Ÿç«äº‰ã€‚

#### ä¸¾ä¾‹ï¼š
å³ä½¿å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ `SingletonEnum.INSTANCE`ï¼Œå®ƒä»¬éƒ½ä¼šå¾—åˆ°åœ¨ç±»åŠ è½½é˜¶æ®µæ„é€ å¥½çš„å”¯ä¸€å¯¹è±¡ï¼Œæ— éœ€é¢å¤–åŒæ­¥ã€‚

---

### **é—®é¢˜ 3ï¼šæšä¸¾å•ä¾‹èƒ½å¦è¢«åå°„ç ´åå•ä¾‹ï¼Ÿ**

**ä¸ä¼šï¼** æšä¸¾ç±»å‹çš„ç»“æ„ç‰¹æ®Šï¼Œæ— æ³•è¢«åå°„ç ´åå•ä¾‹ã€‚è¿™æ˜¯å› ä¸ºï¼š
1. æšä¸¾çš„æ„é€ å™¨æ˜¯ç§æœ‰çš„ï¼Œå¹¶ä¸”å…¶åº•å±‚ä¼šæ£€æµ‹åå°„è°ƒç”¨ã€‚
2. å¦‚æœå°è¯•é€šè¿‡åå°„æ˜¾å¼è°ƒç”¨æšä¸¾ç±»çš„æ„é€ å™¨ï¼ŒJVM ä¼šæŠ›å‡º `IllegalArgumentException`ã€‚

#### éªŒè¯ä»£ç ï¼š
```java
import java.lang.reflect.Constructor;

public class EnumReflectionTest {
    public static void main(String[] args) {
        try {
            // è·å–æšä¸¾çš„æ„é€ å™¨
            Constructor<SingletonEnum> constructor = SingletonEnum.class.getDeclaredConstructor();
            constructor.setAccessible(true);
            SingletonEnum instance = constructor.newInstance(); // åå°„åˆ›å»ºæšä¸¾å¯¹è±¡
        } catch (Exception e) {
            e.printStackTrace(); // ä¼šæŠ›å‡º IllegalArgumentException
        }
    }
}
```

#### è¿è¡Œç»“æœï¼š
```
java.lang.IllegalArgumentException: Cannot reflectively create enum objects
```

---

### **é—®é¢˜ 4ï¼šæšä¸¾å•ä¾‹èƒ½å¦è¢«ååºåˆ—åŒ–ç ´åå•ä¾‹ï¼Ÿ**

æšä¸¾å•ä¾‹å¤©ç„¶å…·å¤‡é˜²æ­¢ååºåˆ—åŒ–ç ´åçš„ç‰¹æ€§ï¼ŒåŸå› æ˜¯ï¼š
1. `Enum` ç±»å‹çš„åºåˆ—åŒ–æœºåˆ¶æ˜¯ç”± JVM å†…éƒ¨å®ç°çš„ï¼Œä¸èµ°æ™®é€šçš„å¯¹è±¡åºåˆ—åŒ–æµç¨‹ã€‚
2. ååºåˆ—åŒ–æšä¸¾å¯¹è±¡æ—¶ï¼ŒJVM ä¼šç›´æ¥è¿”å›æšä¸¾ç±»ä¸­çš„ç°æœ‰å®ä¾‹ï¼Œè€Œä¸æ˜¯ä»åºåˆ—åŒ–æµä¸­åˆ›å»ºæ–°å¯¹è±¡ã€‚

#### éªŒè¯ä»£ç ï¼š
```java
import java.io.*;

public class EnumSerializationTest {
    public static void main(String[] args) throws IOException, ClassNotFoundException {
        SingletonEnum instance1 = SingletonEnum.INSTANCE;

        // åºåˆ—åŒ–æšä¸¾å¯¹è±¡
        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream("enum_singleton.obj"));
        oos.writeObject(instance1);
        oos.close();

        // ååºåˆ—åŒ–æšä¸¾å¯¹è±¡
        ObjectInputStream ois = new ObjectInputStream(new FileInputStream("enum_singleton.obj"));
        SingletonEnum instance2 = (SingletonEnum) ois.readObject();

        // åˆ¤æ–­æ˜¯å¦ç ´åå•ä¾‹
        System.out.println(instance1 == instance2); // è¾“å‡ºï¼štrueï¼Œå•ä¾‹æ²¡æœ‰ç ´å
    }
}
```

---

### **é—®é¢˜ 5ï¼šæšä¸¾å•ä¾‹å±äºæ‡’æ±‰å¼è¿˜æ˜¯é¥¿æ±‰å¼ï¼Ÿ**

**æšä¸¾å•ä¾‹æœ¬è´¨ä¸Šå±äºé¥¿æ±‰å¼å•ä¾‹**ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯**åœ¨ç±»åŠ è½½é˜¶æ®µå®Œæˆåˆå§‹åŒ–**ï¼š
- æšä¸¾çš„å®ä¾‹åœ¨ç±»åŠ è½½æ—¶å°±è¢«åˆ›å»ºå¹¶åˆå§‹åŒ–ã€‚
- å³ä½¿ç¨‹åºä¸­ä»æœªè®¿é—®è¿‡ `SingletonEnum.INSTANCE`ï¼Œæšä¸¾å®ä¾‹ä¾ç„¶ä¼šè¢«åŠ è½½ã€‚

#### ä¼˜ç‚¹ï¼š
- çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€ä¸ºå•ä¾‹åˆå§‹åŒ–é¢å¤–ç¼–å†™åŒæ­¥ä»£ç ã€‚
- å®ç°ç®€æ´ï¼ŒJVM è‡ªåŠ¨ä¿è¯ã€‚

#### ç¼ºç‚¹ï¼š
- å¦‚æœæšä¸¾å®ä¾‹è¾ƒå¤šï¼Œå¹¶ä¸”åŒ…å«è¾ƒå¤§çš„åˆå§‹åŒ–é€»è¾‘ï¼Œä¼šå¯¼è‡´ç±»åŠ è½½é˜¶æ®µæ€§èƒ½å¼€é”€å¢åŠ ã€‚

---

### **é—®é¢˜ 6ï¼šæšä¸¾å•ä¾‹å¦‚æœå¸Œæœ›åŠ å…¥ä¸€äº›åˆå§‹åŒ–é€»è¾‘ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ**

å¯ä»¥é€šè¿‡æ·»åŠ æšä¸¾çš„æ„é€ æ–¹æ³•å’Œé™æ€æ–¹æ³•æ¥å®ç°åˆå§‹åŒ–é€»è¾‘ã€‚æšä¸¾çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œå¯ä»¥ç”¨æ¥åœ¨å®ä¾‹åˆ›å»ºæ—¶æ‰§è¡Œåˆå§‹åŒ–ã€‚

#### ä¿®æ”¹ä»£ç ï¼š
```java
public enum SingletonEnum {
    INSTANCE; // æšä¸¾å•ä¾‹å®ä¾‹

    private String configuration;

    // æšä¸¾çš„æ„é€ æ–¹æ³•
    SingletonEnum() {
        // åˆå§‹åŒ–é€»è¾‘
        configuration = "System Configuration Loaded";
    }

    public String getConfiguration() {
        return configuration;
    }
}
```

#### æµ‹è¯•ï¼š
```java
public class TestEnumInitialization {
    public static void main(String[] args) {
        SingletonEnum instance = SingletonEnum.INSTANCE;
        System.out.println(instance.getConfiguration()); // è¾“å‡ºï¼šSystem Configuration Loaded
    }
}
```

#### åˆ†æï¼š
- æšä¸¾ç±»å‹çš„æ„é€ å™¨ä¼šåœ¨ç±»åŠ è½½æ—¶è°ƒç”¨ï¼Œä¸”åªè°ƒç”¨ä¸€æ¬¡ã€‚
- å¯ç”¨æšä¸¾æ„é€ å™¨å®ç°å•ä¾‹å®ä¾‹çš„åˆå§‹åŒ–é€»è¾‘ã€‚

---

### æ€»ç»“

**ä¸ºä½•æšä¸¾å•ä¾‹å®Œç¾é€‚åˆå•ä¾‹æ¨¡å¼ï¼Ÿ**
- å®ƒæ˜¯å¤©ç”Ÿçº¿ç¨‹å®‰å…¨çš„ï¼ŒJVM ä¿éšœäº†æšä¸¾å®ä¾‹çš„å”¯ä¸€æ€§ã€‚
- æšä¸¾å®ä¾‹ä¸èƒ½é€šè¿‡åå°„æˆ–åºåˆ—åŒ–ç ´åã€‚
- æšä¸¾çš„åˆå§‹åŒ–æµç¨‹å¤©ç„¶ç¬¦åˆé¥¿æ±‰å¼å•ä¾‹çš„ç‰¹ç‚¹ã€‚

---

# 3 Double Check

https://meowrain.cn/archives/volatile-shi-xian-dan-li-mo-shi-de-shuang-zhong-suo


```java
package cn.meowrain;

public class DoubleSingleton {
    private static volatile DoubleSingleton INSTANCE = null;
    public static DoubleSingleton getInstance() {
        if(INSTANCE != null) {
            return INSTANCE;
        }
        synchronized (DoubleSingleton.class){
            if(INSTANCE != null) {
                return INSTANCE;
            }
            INSTANCE = new DoubleSingleton();
            return INSTANCE;
        }
    }
}

```

![](https://blog.meowrain.cn/api/i/2025/05/27/10zdcs1-0.webp)


# 4 é™æ€å†…éƒ¨ç±»æ‡’æ±‰å¼åˆ›å»ºçº¿ç¨‹å®‰å…¨å•ä¾‹

```
package cn.meowrain;

public class Singleton2 {
    private Singleton2(){}
    // é—®é¢˜1ï¼š å±äºæ‡’æ±‰å¼è¿˜æ˜¯é¥¿æ±‰å¼
    private static class LazyLoader{
        static final Singleton2 INSTANCE = new Singleton2();
    }
    // åœ¨åˆ›å»ºçš„æ—¶å€™æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜
    public static Singleton2 getInstance() {
        return  LazyLoader.INSTANCE;
    }
}

```
![](https://blog.meowrain.cn/api/i/2025/05/27/1132c75-0.webp)

![](https://blog.meowrain.cn/api/i/2025/05/27/1144xf0-0.webp)